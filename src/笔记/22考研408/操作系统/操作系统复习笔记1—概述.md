# 操作系统概述

## 概述

操作系统（Operating System，OS）是指**控制**和**管理**整个计算机系统的**硬件和软件**资源，并合理地组织调度计算机的工作和资源的分配;以**提供给用户和其他软件方便的接口**和环境;它是计算机系统中最基本的**系统软件**。

## 功能

#### 系统资源的管理者

<img src="C:\Users\LIMBO\AppData\Roaming\Typora\typora-user-images\image-20210914223907830.png" alt="image-20210914223907830" style="zoom: 67%;" />

#### 向上层提供方便易用的服务

GUI:图形化用户接口(Graphical User Interface)

联机命令接口实例(Windows系统）联机命令接口=交互式命令接口 `特点:用户说一句系统跟着做一句`

脱机命令接口实例(Windows系统)	脱机命令接口=批处理命令接口 `特点:用户说一堆系统跟着做一堆`

程序接口;可以在程序中进行**==系统调用==**来使用程序接口。普通用户不能直接使用程序接口，只能通过程序代码**间接**使用。

#### 对硬件机器的拓展

需要实现**对硬件机器的拓展**

没有任何软件支持的计算机成为**裸机**。在裸机上安装的操作系统,可以提供资源管理功能和方便用户的服务功能，将裸机改造成功能更强、使用更方便的机器

通常把覆盖了软件的机器成为**扩充机器**，又称之为**虚拟机**

## 特征

### ==并发==

**并发:**指两个或多个事件在同一时间间隔内发生。这些事件宏观上是同时发生的，但微观上是交替发生的

> **常考易混概念――并行:指两个或多个事件在同一时刻同时发生。**

**操作系统的并发性**指计算机系统中“同时”运行着多个程序，这些程序宏观上看是同时运行着的，而微观上看是交替运行的。

操作系统就是伴随着“多道程序技术”而出现的。因此，==操作系统和程序并发是一起诞生的==。

==注意（重要考点）:==

- 单核CPU同一时刻只能执行一个程序，各个程序只能并发地执行
- 多核CPU同一时刻可以同时执行多个程序，多个程序可以并行地执行

### ==共享==

**共享**即资源共享，是指系统中的资源可供内存中多个并发执行的进程共同使用。

#### 互斥共享方式

系统中的某些资源，虽然可以提供给多个进程使用，但==一个时间段内只允许一个进程访问该资源==

#### 同时共享方式

系统中的某些资源，==允许一个时间段内由多个进程**“同时”**对它们进行访问==

> 如果失去并发性，则系统中只有一个程序正在运行，则共享性失去存在的意义
>
> 如果失去共享性，则QQ和微信不能同时访问硬盘资源，就无法实现同时发送文件，也就无法并发

### 虚拟

**虚拟**是指把一个物理上的实体变为若干个逻辑上的对应物。物理实体（前者）是实际存在的，而逻辑上对应物（后者)是用户感受到的。

虚拟技术：

* **空分复用技术（如虚拟存储器技术）**
* **时分复用技术（如虚拟存储器）**

### 异步

**异步**是指，在多道程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行不是一贯到底的，而是走走停停，以不可预知的速度向前推进，这就是进程的异步性。

![image-20210914230041207](C:\Users\LIMBO\AppData\Roaming\Typora\typora-user-images\image-20210914230041207.png)

## 发展与分类

### 手工阶段

<img src="C:\Users\LIMBO\AppData\Roaming\Typora\typora-user-images\image-20210914230225953.png" alt="image-20210914230225953" style="zoom:80%;" />

### 单道批处理阶段

引入脱机输入/输出技术（用外围机+磁带完成)，并由监督程序负责控制作业的输入、输出

<img src="C:\Users\LIMBO\AppData\Roaming\Typora\typora-user-images\image-20210914230647797.png" alt="image-20210914230647797" style="zoom:80%;" />

<img src="C:\Users\LIMBO\AppData\Roaming\Typora\typora-user-images\image-20210914230820902.png" alt="image-20210914230820902" style="zoom:80%;" />

- 主要优点:缓解了一定程度的人机速度矛盾，资源利用率有所提升。
- 主要缺点:**内存中仅能有一道程序运行**，只有该程序运行结束之后才能调入下一道程序。**CPU有大量的时间是在空闲等待I/O完成**。资源利用率依然很低。

### 多道批处理阶段

<img src="C:\Users\LIMBO\AppData\Roaming\Typora\typora-user-images\image-20210914231026389.png" alt="image-20210914231026389" style="zoom:80%;" />

<img src="C:\Users\LIMBO\AppData\Roaming\Typora\typora-user-images\image-20210914231046604.png" alt="image-20210914231046604" style="zoom:80%;" />

- 主要优点:**多道程序并发执行**，**共享**计算机资源。**资源利用率大幅提升**，CPU和其他资源更能保持“忙碌”状态，系统吞吐量增大。
- 主要缺点:用户响应时间长，**没有人机交互功能**（用户提交自己的作业之后就只能等待计算机处理完成，中间不能控制自己的作业执行。eg:无法调试程序/无法在程序运行过程中输入一些参数)

### 分时操作系统

分时操作系统:计算机以**时间片**为单位**轮流为各个用户/作业服务**，各个用户可通过终端与计算机进行交互。

- 主要优点:用户请求可以被即时响应，解决了**人机交互问题**。允许多个用户同时使用一台计算机，并且用户对计算机的操作相互独立，感受不到别人的存在。
- 主要缺点:**不能优先处理一些紧急任务**。操作系统对各个用户/作业都是完全公平的，循环地为每个用户/作业服务一个时间片，不区分任务的紧急性。

### 实时操作系统

主要优点:能够优先响应一些紧急任务，某些紧急任务不需时间片排队。

在实时操作系统的控制下，计算机系统接收到外部信号后及时进行处理，并且要在严格的时限内处理完事件。实时操作系统的主要特点是及时性和可靠性

- **硬实时系统：必须在绝对严格的规定时间内完成处理**
- **软实时系统：能接受偶尔违反时间规定**

### 其他

**网络操作系统**:是伴随着计算机网络的发展而诞生的，能把网络中各个计算机有机地结合起来，实现数据传送等功能，==**实现网络中各种资源的共享（如文件共享）和各台计算机之间的通信**==。(如: Windows NT就是一种典型的网络操作系统，网站服务器就可以使用)

**分布式操作系统:**主要特点是**分布性和并行性**。系统中的各台计算机地位相同，**==任何工作都可以分布在这些计算机上，由它们并行、协同完成这个任务。==**

<img src="C:\Users\LIMBO\AppData\Roaming\Typora\typora-user-images\image-20210914231606673.png" alt="image-20210914231606673" style="zoom:80%;" />

## 运行机制

### 应用程序 vs 内核程序

我们普通程序员写的程序就是==“应用程序”==

微软、苹果有一帮人负责实现操作系统，他们写的是==“内核程序”==

由很多内核程序组成了“==操作系统内核==”，或简称“==内核（Kernel）==”内核是操作系统最重要最核心的部分，也是==最接近硬件的部分==

甚至可以说，一个操作系统只要有内核就够了*(eg: Docker一>仅需Linux内核）*

**操作系统的功能未必都在内核中，如：图形化用户界面GUI**

### 特权指令 vs 非特权指令

**应用程序**只能使用**“非特权指令”**，如：加法指令、减法指令等

操作系统**内核**作为“管理者”，有时会让CPU执行一些“特权指令”，如:==内存清零指令==。这些指令影响重大,只允许“管理者”——即操作系统内核来使用

### 内核态 vs 用户态

CPU有两种状态，“内核态”和“用户态”

- 处于内核态时，说明此时正在运行的是内核程序，此时可以执行特权指令
- 处于用户态时，说明此时正在运行的是应用程序，此时只能执行非特权指令



- **内核态→用户态**:执行一==条特权指令――修改PSW==的标志位为“用户态”，这个动作意味着操作系统将==主动==让出CPU使用权
- **用户态→内核态**:由==“中断”==引发，==硬件自动完成变态过程==，触发中断信号意味着操作系统将强行夺回CPU的使用权
  身

<img src="C:\Users\LIMBO\AppData\Roaming\Typora\typora-user-images\image-20210914232251045.png" alt="image-20210914232251045" style="zoom:80%;" />

## ==中断和异常==

CPU上会运行两种程序，一种是**操作系统内核程序****，一种是**应用程序**

在合适的情况下，操作系统内核会把CPU的使用权主动让给应用程序

“中断”是**让操作系统内核夺回CPU使用权**的唯一途径

> ==中断服务程序是在内核态下执行的==

**==内核态→用户态==**:执行一条**特权指令――修改PSW**的标志位为“用户态”，这个动作意味着操作系统将主动让出CPU使用权

==**用户态→内核态**==:由**“中断”**引发，**硬件自动完成变态过程**，触发中断信号意味着操作系统将强行夺回CPU的使用权

> 执行**“陷入指令”**，意味着应用程序主动地将CPU控制权还给操作系统内核。
>
> **“系统调用”**就是通过陷入指令完成的

**内中断：与当前执行的<font color='red'>指令有关</font>,中断信号来源于<font color='red'>CPU内部</font>**

**外中断：与当前执行的<font color='red'>指令无关</font>!中断信号来源于<font color='red'>CPU外部</font>**

<img src="C:\Users\LIMBO\AppData\Roaming\Typora\typora-user-images\image-20211015155821304.png" alt="image-20211015155821304"  />

<img src="C:\Users\LIMBO\AppData\Roaming\Typora\typora-user-images\image-20210919180416917.png" alt="image-20210919180416917" style="zoom:80%;" />

## ==系统调用==

操作系统作为用户和计算机硬件之间的接口，需要向上提供一些简单易用的服务。主要包括命令接口和程序接口。其中，程序接口由一组**系统调用**组成。

“系统调用”是操作系统提供给应用程序（程序员/编程人员）使用的接口，可以理解为一种可供应用程序调用的特殊函数，==应用程序可以通过**系统调用**来请求获得操作系统内核的服务==

<img src="C:\Users\LIMBO\AppData\Roaming\Typora\typora-user-images\image-20210919180640077.png" alt="image-20210919180640077" style="zoom:80%;" />

应用程序通过系统调用请求操作系统的服务。而系统中的各种共享资源都由操作系统内核统一掌管，因此<font color='red'>凡是与共享资源有关的操作(如存储分配、I/O操作、文件管理等），都必须通过系统调用的方式向操作系统内核提出服务请求</font>，由操作系统内核代为完成。这样<font color='red'>可以保证系统的稳定性和安全性</font>，防止用户进行非法操作。

注意：

1. 陷入指令是在**用户态**执行的，执行陷入指令之后立即引发一个**内中断**，使CPU**进入核心态**
2. **发出系统调用请求**是在**用户态**,而**对系统调用的相应处理**在**核心态**下进行

==系统调用的过程：==

1. 正在运行的进程先传递系统调用参数
2. 然后由陷入指令将用户态转为内核态，并将返回地址压入堆栈以备后用
3. 接下来CPU执行相应的内核态服务程序
4. 最后回到用户态

<img src="C:\Users\LIMBO\AppData\Roaming\Typora\typora-user-images\image-20210919180930130.png" alt="image-20210919180930130" style="zoom:80%;" />

## 程序运行时内存映像与地址空间

<img src="C:\Users\LIMBO\AppData\Roaming\Typora\typora-user-images\image-20211205180644112.png" alt="image-20211205180644112" style="zoom:80%;" />

代码段:即程序的二进制代码，代码段是==只读==的，可以被多个进程共享。

数据段:即程序运行时加工处理对象，包括==全局变量==和==静态变量==。

进程控制块（PCB）:存放在系统区。操作系统通过PCB来控制和管理进程。

堆:用来存放==动态分配的变量==。

栈:用来实现==函数调用==。

==代码段和数据段==在程序调入内存时就==指定了大小==,而堆和栈不一样。当调用像malloc和 free这样的C标准库函数时，==堆==可以在运行时动==态地扩展和收缩==。用户==栈==在程序运行期间也可以==动态地扩展和收缩==，每次调用一个函数，栈就会增长;从一个函数返回时，栈就会收缩。

## 操作系统的体系结构

### 分层结构

<img src="C:\Users\LIMBO\AppData\Roaming\Typora\typora-user-images\image-20211205181127441.png" alt="image-20211205181127441" style="zoom:80%;" />

### 模块化

模块化是将操作系统按功能划分为若干个具有一定独立性的模块。每个模块具有某方面的管理功能，并规定好各模块间的接口，==使各模块之间能通过接口进行通信==。还可以进一步将各模块细分为若干个具有一定功能的子模块，同样也规定好各子模块之间的接口。把这种设计方法称为模块-接口法，图1.3所示为由模块、子模块等组成的模块化操作系统结构。

<img src="C:\Users\LIMBO\AppData\Roaming\Typora\typora-user-images\image-20211205181224324.png" alt="image-20211205181224324" style="zoom:80%;" />

### 大内核、微内核

注意：

1. **操作系统内核**需要运行在**内核态**
2. 操作系统的**非内核功能**运行在**用户态**

![image-20210919181212043](C:\Users\LIMBO\AppData\Roaming\Typora\typora-user-images\image-20210919181212043.png)

<img src="C:\Users\LIMBO\AppData\Roaming\Typora\typora-user-images\image-20210919181242211.png" alt="image-20210919181242211" style="zoom:80%;" />

### 外核

<img src="C:\Users\LIMBO\AppData\Roaming\Typora\typora-user-images\image-20211205181324274.png" alt="image-20211205181324274" style="zoom:80%;" />

------

<img src="C:\Users\LIMBO\AppData\Roaming\Typora\typora-user-images\image-20211205181427543.png" alt="image-20211205181427543" style="zoom:80%;" />

## 虚拟机

虚拟机:使用虚拟化技术，将一台物理机器虚拟化为多台虚拟机器(Virtual Machine, VM)，每个虚拟机器都可以独立运行一个操作系统

同义术语:虚拟机管理程序/虚拟机监控程序/Virtual Machine Monitor/Hypervisor

<img src="C:\Users\LIMBO\AppData\Roaming\Typora\typora-user-images\image-20211205163128217.png" alt="image-20211205163128217" style="zoom:80%;" />

<img src="C:\Users\LIMBO\AppData\Roaming\Typora\typora-user-images\image-20211205163250915.png" alt="image-20211205163250915" style="zoom:80%;" />

